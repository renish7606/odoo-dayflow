{% extends 'hrms/base.html' %}
{% load static %}

{% block title %}Employee Dashboard - Dayflow HRMS{% endblock %}

{% block content %}
<div class="container">
    <!-- Welcome Header -->
    <div class="card card-gradient mb-5 animate-fadeIn">
        <div class="d-flex justify-between items-center">
            <div>
                <h1 style="color: white; margin-bottom: var(--spacing-sm);">
                    Welcome back, {{ user.first_name }}! ðŸ‘‹
                </h1>
                <p style="color: rgba(255,255,255,0.9); margin: 0;">
                    Have a productive day at work
                </p>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 0.875rem; color: rgba(255,255,255,0.8);">{{ user.employee_id }}</div>
                <div style="font-size: 1.25rem; font-weight: 600; color: white;">{{ user.profile.designation }}</div>
            </div>
        </div>
    </div>

    <!-- Quick Access Cards -->
    <div class="grid grid-4 mb-5">
        <a href="{% url 'employee_profile' %}" style="text-decoration: none;">
            <div class="quick-card animate-fadeIn" style="animation-delay: 0.1s;">
                <div class="quick-card-icon">ðŸ‘¤</div>
                <div class="quick-card-title">Profile</div>
                <div class="quick-card-value">{{ user.get_full_name }}</div>
            </div>
        </a>

        <a href="{% url 'attendance_view' %}" style="text-decoration: none;">
            <div class="quick-card animate-fadeIn" style="animation-delay: 0.2s; border-left-color: var(--success);">
                <div class="quick-card-icon" style="background: var(--gradient-success);">ðŸ“Š</div>
                <div class="quick-card-title">Attendance</div>
                <div class="quick-card-value">
                    {% if today_attendance and today_attendance.check_in_time %}
                    <span class="badge badge-success">Present</span>
                    {% else %}
                    <span class="badge badge-warning">Not Marked</span>
                    {% endif %}
                </div>
            </div>
        </a>

        <a href="{% url 'leave_request_list' %}" style="text-decoration: none;">
            <div class="quick-card animate-fadeIn" style="animation-delay: 0.3s; border-left-color: var(--info);">
                <div class="quick-card-icon" style="background: var(--gradient-info);">ðŸ“…</div>
                <div class="quick-card-title">Leave Requests</div>
                <div class="quick-card-value">{{ recent_leaves.count }}</div>
            </div>
        </a>

        <a href="{% url 'payroll_view' %}" style="text-decoration: none;">
            <div class="quick-card animate-fadeIn" style="animation-delay: 0.4s; border-left-color: var(--warning);">
                <div class="quick-card-icon" style="background: var(--gradient-warning);">ðŸ’°</div>
                <div class="quick-card-title">Salary</div>
                <div class="quick-card-value">
                    {% if latest_payroll %}
                    â‚¹{{ latest_payroll.net_salary|floatformat:0 }}
                    {% else %}
                    Not Set
                    {% endif %}
                </div>
            </div>
        </a>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-2">
        <!-- Today's Attendance -->
        <div class="card animate-fadeIn" style="animation-delay: 0.5s;">
            <div class="card-header">
                <h3 class="card-title">Today's Attendance</h3>
            </div>
            <div class="card-body">
                {% if today_attendance %}
                {% if today_attendance.check_in_time %}
                <div class="mb-3">
                    <p class="text-gray" style="font-size: 0.875rem; margin-bottom: var(--spacing-xs);">Check-in Time
                    </p>
                    <p class="fw-bold" style="font-size: 1.25rem; color: var(--success);">
                        {{ today_attendance.check_in_time|date:"h:i A" }}
                    </p>
                </div>

                {% if today_attendance.check_out_time %}
                <div class="mb-3">
                    <p class="text-gray" style="font-size: 0.875rem; margin-bottom: var(--spacing-xs);">Check-out Time
                    </p>
                    <p class="fw-bold" style="font-size: 1.25rem; color: var(--error);">
                        {{ today_attendance.check_out_time|date:"h:i A" }}
                    </p>
                </div>
                <div>
                    <p class="text-gray" style="font-size: 0.875rem; margin-bottom: var(--spacing-xs);">Total Hours</p>
                    <p class="fw-bold" style="font-size: 1.25rem;">{{ today_attendance.total_hours }} hrs</p>
                </div>
                {% else %}
                <p class="text-warning">You haven't checked out yet</p>
                {% endif %}
                {% else %}
                <p class="text-gray">You haven't checked in today</p>
                {% endif %}
                {% else %}
                <p class="text-gray">No attendance record for today</p>
                {% endif %}

                <div class="mt-4">
                    <a href="{% url 'attendance_view' %}" class="btn btn-primary btn-block">
                        Manage Attendance
                    </a>
                </div>
            </div>
        </div>

        <!-- Recent Leave Requests -->
        <div class="card animate-fadeIn" style="animation-delay: 0.6s;">
            <div class="card-header">
                <h3 class="card-title">Recent Leave Requests</h3>
            </div>
            <div class="card-body">
                {% if recent_leaves %}
                {% for leave in recent_leaves|slice:":3" %}
                <div
                    style="padding: var(--spacing-md); background: var(--gray-50); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                    <div class="d-flex justify-between items-center mb-2">
                        <span class="fw-semibold">{{ leave.get_leave_type_display }}</span>
                        <span
                            class="badge badge-{% if leave.status == 'APPROVED' %}success{% elif leave.status == 'REJECTED' %}danger{% else %}warning{% endif %}">
                            {{ leave.get_status_display }}
                        </span>
                    </div>
                    <p class="text-gray" style="font-size: 0.875rem; margin: 0;">
                        {{ leave.start_date|date:"M d" }} - {{ leave.end_date|date:"M d, Y" }} ({{ leave.total_days }}
                        days)
                    </p>
                </div>
                {% endfor %}
                {% else %}
                <p class="text-gray">No leave requests yet</p>
                {% endif %}

                <div class="mt-4">
                    <a href="{% url 'leave_request_create' %}" class="btn btn-success btn-block">
                        Request Leave
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}